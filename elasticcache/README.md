# CSV  
# parametergroups.csv  
| 列名             | 説明                                                                                                   | 必須/任意   | 補足                                                                                                                                                              |
| :--------------- | :----------------------------------------------------------------------------------------------------- | :---------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `REGION`         | パラメータグループを作成または操作するAWSリージョンを指定します。                                                      | 必須        | スクリプト内のすべてのAWS CLIコマンドで使用されます。                                                                                                               |
| `NAME`           | 作成または操作対象となるキャッシュパラメータグループの名前です。                                                               | 必須        | スクリプトは、指定されたリージョンでこの名前のパラメータグループを見つけるか、または新しいものを作成する際に使用します。                                                                      |
| `PARAMETER_FAMILY` | パラメータグループが関連付けられるキャッシュエンジンファミリーを指定します (例: `redis6.x`, `memcached1.6`)。                                | 必須        | 新しいパラメータグループを作成する際に `--cache-parameter-group-family` として使用されます。                                                                               |
| `DESCRIPTION`    | キャッシュパラメータグループの説明です。                                                                             | 必須        | 新しいパラメータグループを作成する際に `--description` として使用されます。                                                                                             |
| `PARAMS_FILE`    | このパラメータグループに適用するパラメータ設定を記述したCSVファイルへのパスです（このCSVファイルからの相対パスまたは絶対パス）。 | 任意        | この列が空欄でない場合、スクリプトはこのファイルからパラメータ設定を読み込み、該当するパラメータグループに適用します。このファイル内の各行は `PARAM_NAME,VALUE` の形式である必要があります。     |

<br>

**PARAMS_FILE (パラメータ設定ファイル) の列定義:**

`PARAMS_FILE` で指定するCSVファイルは、以下の列を持つ必要があります。

| 列名         | 説明                                                                     | 必須/任意 | 補足                                                                   |
| :----------- | :----------------------------------------------------------------------- | :-------- | :--------------------------------------------------------------------- |
| `PARAM_NAME` | 設定を変更するパラメータの名前です。                                         | 必須      | `modify-cache-parameter-group` コマンドの `--parameter-name-values` 引数で使用されます。 |
| `VALUE`      | パラメータに設定する値です。                                             | 必須      | `modify-cache-parameter-group` コマンドの `--parameter-name-values` 引数で使用されます。 |

**補足事項:**

* スクリプトは、まず指定されたパラメータグループが存在するか確認し、存在しない場合のみ作成します。既存のパラメータグループに対しては、作成ステップはスキップされますが、`PARAMS_FILE` が指定されていればパラメータの変更は適用されます。
* `PARAMS_FILE` が指定されていない行については、パラメータグループの作成のみ（必要であれば）行われ、パラメータの変更はスキップされます。
* `PARAMS_FILE` のパスは、メインのCSVファイルがあるディレクトリからの相対パスとして優先的に解決され、見つからない場合はスクリプトがあるディレクトリからの相対パスとして試行されます。
* ElastiCacheのパラメータ変更には `APPLY_METHOD` の概念がありません（パラメータによって即時適用か再起動保留かが決まります）。`PARAMS_FILE` の定義には `APPLY_METHOD` 列は含めないでください。

## subnetgroups.csv

| 列名        | 説明                                                                                                                                       | 必須/任意 | 補足                                                                                                                                                                                                                                                           |
| :---------- | :----------------------------------------------------------------------------------------------------------------------------------------- | :-------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `REGION`    | キャッシュサブネットグループを作成するAWSリージョンを指定します。                                                                                    | 必須      | スクリプトはサブネットの検索およびサブネットグループの作成コマンドでこのリージョンを使用します。                                                                                                       |
| `NAME`      | 作成するキャッシュサブネットグループの名前です。                                                                                                   | 必須      | スクリプトは `create-cache-subnet-group` コマンドの `--cache-subnet-group-name` として使用します。                                                                                                  |
| `SUBNETS`   | キャッシュサブネットグループに含める1つ以上のサブネットを指定します。複数のサブネットを指定する場合は、セミコロン `;` で区切ってください。各サブネットはサブネットIDまたはサブネットのNameタグの値で指定できます。 | 必須      | スクリプトはセミコロンで分割し、各項目をサブネットID (`subnet-...`) またはサブネットのNameタグとしてリージョン内で検索します。見つかったサブネットIDを収集し、`create-cache-subnet-group` コマンドの `--subnet-ids` として使用します。リスト内に有効なサブネットが一つも見つからない場合は、その行の処理はスキップされます。 |
| `DESCRIPTION` | キャッシュサブネットグループの説明です。                                                                                                   | 必須      | スクリプトは `create-cache-subnet-group` コマンドの `--cache-subnet-group-description` として使用されます。                                                                                              |

<br>

**補足事項:**

* スクリプトは、指定された名前のキャッシュサブネットグループが既に存在するかどうかの明示的なチェックは行いません。`create-cache-subnet-group` コマンドを実行し、成功/失敗のメッセージを表示します。すでに存在する場合は作成に失敗しますが、スクリプトはエラーとして処理します。
* `SUBNETS` 列で指定されたサブネットがすべて指定リージョンで見つからない場合、その行のキャッシュサブネットグループの作成はスキップされます。


## redis.csv 
 
| 列名                       | 説明                                                                                                                                                             | 必須/任意      | 補足                                                                                                                                                                                                                                                                                                                          |
| :------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `REGION`                   | ElastiCacheクラスターを作成/復元するAWSリージョンを指定します。                                                                                                    | 必須           | スクリプト内のすべてのAWS CLIコマンドで使用されます。                                                                                                                                                                                                                                                                       |
| `CLUSTERID`                | 作成または復元するキャッシュクラスター（またはレプリケーショングループ）の識別子です。                                                                                             | 必須           | スクリプトは `--cache-cluster-id` または `--replication-group-id` として使用します。                                                                                                                                                                                                                                           |
| `ENGINE`                   | 使用するキャッシュエンジンのタイプです (例: `redis`, `memcached`)。                                                                                                | 条件付き必須   | 新規作成 (`RESTORE_MODE` が `enabled` でない場合) およびスナップショットからの復元 (`RESTORE_MODE` が `enabled` の場合) コマンドで使用されます。                                                                                                                                                                                |
| `NODETYPE`                 | キャッシュノードのインスタンスタイプを指定します (例: `cache.t3.small`)。                                                                                            | 必須           | クラスター作成/復元コマンドの `--cache-node-type` として使用されます。                                                                                                                                                                                                                                                       |
| `NUMCACHENODES`            | シングルノードモード (`CLUSTER_MODE` が `disabled`) の場合のノード数です。                                                                                         | 条件付き必須   | シングルノードモードでの新規作成/復元時に必須です。クラスターモード (`CLUSTER_MODE` が `enabled`) の場合はスクリプトで直接使用されていません（代わりに `NUM_SHARDS` が使用されます）。                                                                                                                                                   |
| `PARAMETERGROUPNAME`       | 適用するキャッシュパラメータグループの名前です。                                                                                                                 | 必須           | クラスター作成/復元コマンドの `--cache-parameter-group-name` として使用されます。                                                                                                                                                                                                                                           |
| `ENGINEVERSION`            | 使用するエンジンのバージョンです。                                                                                                                               | 条件付き必須   | 新規作成 (`RESTORE_MODE` が `enabled` でない場合) およびスナップショットからの復元 (`RESTORE_MODE` が `enabled` の場合) コマンドで使用されます。                                                                                                                                                                                |
| `CACHESUBNETGROUPNAME`     | キャッシュクラスターを配置するキャッシュサブネットグループの名前です。                                                                                               | 必須           | スクリプトは指定されたリージョンでこのサブネットグループが存在するか検証し、クラスター作成/復元コマンドの `--cache-subnet-group-name` として使用します。                                                                                                                                                                     |
| `SECURITYGROUPIDENTIFIERS` | クラスターに関連付けるVPCセキュリティグループの名前またはIDをセミコロン `;` 区切りで指定します。                                                                             | 任意           | スクリプトは指定された各名前/IDを解決し、そのIDを `--security-group-ids` としてクラスター作成/復元コマンドに渡します。空欄の場合、デフォルトのセキュリティグループが適用される可能性があります（VPC設定による）。いずれかのセキュリティグループが見つからない場合は処理がスキップされます。                                           |
| `AT_REST_ENCRYPTION`       | 保管中（At-rest）の暗号化を有効にするか (`enabled`/`disabled`)。                                                                                                    | 必須           | スクリプトは入力検証に使用し、有効な場合は `--at-rest-encryption-enabled` をクラスターモードのレプリケーショングループ作成/復元コマンドに追加します。転送中の暗号化 (`IN_TRANSIT_ENCRYPTION`) を有効にするには、これも有効である必要があります。                                                                                          |
| `CLUSTER_MODE`             | クラスターモード（レプリケーショングループ）を有効にするか (`enabled`/`disabled`)。                                                                                      | 必須           | スクリプトはこれに基づいて `create-replication-group` または `create-cache-cluster` のどちらを使用するかを決定します。また、入力検証 (`AUTOMATIC_FAILOVER` に必要) にも使用されます。                                                                                                                                            |
| `NUM_SHARDS`               | クラスターモード (`CLUSTER_MODE` が `enabled`) の場合のシャード（ノードグループ）数です。                                                                              | 条件付き必須   | クラスターモードでの新規作成時に必須です。スクリプトは `--num-node-groups` として使用します。その他の場合はスクリプトで直接使用されていません。                                                                                                                                                                                |
| `IN_TRANSIT_ENCRYPTION`    | 転送中（In-transit）の暗号化を有効にするか (`enabled`/`disabled`)。                                                                                                  | 必須           | スクリプトは入力検証に使用し、有効な場合は `--transit-encryption-enabled` をクラスター作成/復元コマンドに追加します。これには保管中の暗号化 (`AT_REST_ENCRYPTION`) が有効である必要があります。                                                                                                                                    |
| `MAINTENANCE_WINDOW`       | メンテナンスウィンドウです (例: `wed:03:00-wed:04:00`)。                                                                                                         | 条件付き必須   | `SNAPSHOT_ENABLED` が `enabled` の場合のみ、スクリプトはこの値を `--preferred-maintenance-window` として使用します。Restoreモードの場合でも、snapshot-related parametersとして処理されます。                                                                                                                                     |
| `AUTO_UPGRADE`             | マイナーエンジンバージョンの自動アップグレードを有効にするか (`enabled`/`disabled`)。                                                                                    | 必須           | スクリプトは `--auto-minor-version-upgrade` または `--no-auto-minor-version-upgrade` として使用します。                                                                                                                                                                                                                    |
| `SNAPSHOT_ENABLED`         | 自動スナップショットを有効にするか (`enabled`/`disabled`)。                                                                                                      | 必須           | スクリプトは、この値が `enabled` の場合にのみ、`SNAPSHOT_WINDOW`, `SNAPSHOT_RETENTION`, `MAINTENANCE_WINDOW` をコマンドに追加します。Restoreモードの場合でもこの列の `enabled` 判定によりこれらのパラメータがコマンドに追加されるロジックになっています。                                                                          |
| `SNAPSHOT_WINDOW`          | 自動スナップショットウィンドウです (例: `05:00-06:00`)。                                                                                                       | 条件付き必須   | `SNAPSHOT_ENABLED` が `enabled` の場合のみ、スクリプトはこの値を `--snapshot-window` として使用します。空欄または "null" の場合は追加されません。                                                                                                                                                                       |
| `SNAPSHOT_RETENTION`       | 自動スナップショットの保持期間（日数）です。                                                                                                                   | 条件付き必須   | `SNAPSHOT_ENABLED` が `enabled` の場合のみ、スクリプトはこの値を `--snapshot-retention-limit` として使用します。                                                                                                                                                                                                     |
| `AUTOMATIC_FAILOVER`       | マルチAZによる自動フェイルオーバーを有効にするか (`enabled`/`disabled`)。                                                                                              | 必須           | スクリプトは入力検証に使用し、有効な場合はクラスターモードのレプリケーショングループ作成/復元コマンドに `--automatic-failover-enabled` を追加します。有効にするには `CLUSTER_MODE` も `enabled` である必要があります。                                                                                                      |
| `TAGS`                     | リソースに付与するタグを `Key=Value` 形式で指定します。複数のタグはセミコロン `;` で区切ります。                                                                           | 任意           | 指定された場合、スクリプトはこれをJSON形式に変換し、一時ファイルに保存して `--tags file://` 引数としてクラスター作成/復元コマンドに渡します。空欄の場合はタグは付与されません。                                                                                                                                               |
| `SNAPSHOT_NAME`            | 復元元となるスナップショットの識別子です。                                                                                                                     | 条件付き必須   | `RESTORE_MODE` が `enabled` の場合に必須です。スクリプトは指定されたリージョンでこのスナップショットが存在するか検証し、スナップショットからの復元コマンドの `--snapshot-name` として使用します。`RESTORE_MODE` が `disabled` の場合は無視されます。                                                                           |
| `RESTORE_MODE`             | スナップショットから復元を行うか (`enabled`/`disabled`)。                                                                                                      | 必須           | この値が `enabled` の場合、スクリプトはスナップショットからの復元 (`create-replication-group` または `create-cache-cluster` に `--snapshot-name` を付加) を実行します。`disabled` の場合、新規クラスター作成を実行します。                                                                                             |

<br>

**補足事項:**

* スクリプトは、指定されたクラスター識別子を持つクラスターが既に存在するかどうかの明示的なチェックは行いません。作成/復元コマンドを実行し、成功/失敗を判定します。既に存在する場合はコマンドが失敗しますが、スクリプトはそれをエラーとして報告します。
* クラスターモード (`CLUSTER_MODE=enabled`) で新規作成する場合、スクリプトは `REPLICAS_PER_NODE_GROUP` を **1に固定** しています。リードレプリカを増やしたい場合はスクリプトを修正する必要があります。
* `SNAPSHOT_ENABLED` 列は自動スナップショットの設定を制御しますが、スクリプトのロジックでは、この列が `enabled` であれば `MAINTENANCE_WINDOW`, `SNAPSHOT_WINDOW`, `SNAPSHOT_RETENTION` がコマンドに追加されます。これは新規作成時だけでなく、復元時にも影響します。
* `SNAPSHOT_NAME` が指定されている場合は、`RESTORE_MODE` が `enabled` である必要があります（スクリプトはこの明示的なチェックを行いませんが、論理的にはそのように動作します）。
* `SOURCE_DB_IDENTIFIER` 列はCSVに含まれていますが、スクリプトでは**使用されていません**（RDS Auroraスクリプトからの残りの可能性があります）。
