# CSV 
## parametergroups.csv

| 列名             | 説明                                                                                                   | 必須/任意   | 補足                                                                                                                                                              |
| :--------------- | :----------------------------------------------------------------------------------------------------- | :---------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `REGION`         | パラメータグループを作成または操作するAWSリージョンを指定します。                                                      | 必須        | スクリプト内のすべてのAWS CLIコマンドで使用されます。                                                                                                               |
| `NAME`           | 作成または操作対象となるパラメータグループの名前です。                                                                   | 必須        | スクリプトは、指定されたリージョンでこの名前のパラメータグループを見つけるか、または新しいものを作成する際に使用します。                                                                      |
| `TYPE`           | パラメータグループの種類を指定します。                                                                     | 必須        | スクリプトは `"cluster"` (DBクラスターパラメータグループ) または `"instance"` (DBパラメータグループ) を処理します。これ以外の値の場合はスキップされます。                                           |
| `PARAMETER_FAMILY` | パラメータグループが関連付けられるDBエンジンファミリーを指定します。                                                               | 必須        | 新しいパラメータグループを作成する際に `--db-parameter-group-family` または `--db-cluster-parameter-group-family` として使用されます。                                                 |
| `DESCRIPTION`    | パラメータグループの説明です。                                                                             | 必須        | 新しいパラメータグループを作成する際に `--description` として使用されます。                                                                                             |
| `PARAMS_FILE`    | このパラメータグループに適用するパラメータ設定を記述したCSVファイルへのパスです（このCSVファイルからの相対パスまたは絶対パス）。 | 任意        | この列が空欄でない場合、スクリプトはこのファイルからパラメータ設定を読み込み、該当するパラメータグループに適用します。このファイル内の各行は `PARAM_NAME,VALUE,APPLY_METHOD` の形式である必要があります。 |

<br>

**PARAMS_FILE (パラメータ設定ファイル) の列定義:**

`PARAMS_FILE` で指定するCSVファイルは、以下の列を持つ必要があります。

| 列名           | 説明                                                                                                   | 必須/任意 | 補足                                                                 |
| :------------- | :----------------------------------------------------------------------------------------------------- | :-------- | :------------------------------------------------------------------- |
| `PARAM_NAME`   | 設定を変更するパラメータの名前です。                                                                       | 必須      | `modify-db-parameter-group` または `modify-db-cluster-parameter-group` コマンドの `--parameters` 引数で使用されます。 |
| `VALUE`        | パラメータに設定する値です。                                                                           | 必須      | `modify-db-parameter-group` または `modify-db-cluster-parameter-group` コマンドの `--parameters` 引数で使用されます。 |
| `APPLY_METHOD` | パラメータ変更をいつ適用するかを指定します。`immediate` または `pending-reboot` のいずれかです。                       | 必須      | `modify-db-parameter-group` または `modify-db-cluster-parameter-group` コマンドの `--parameters` 引数で使用されます。 |

**補足事項:**

* スクリプトは、まず指定されたパラメータグループが存在するか確認し、存在しない場合のみ作成します。既存のパラメータグループに対しては、作成ステップはスキップされますが、`PARAMS_FILE` が指定されていればパラメータの変更は適用されます。
* `PARAMS_FILE` が指定されていない行については、パラメータグループの作成のみ（必要であれば）行われ、パラメータの変更はスキップされます。
* `PARAMS_FILE` のパスは、メインのCSVファイルがあるディレクトリからの相対パスとして優先的に解決され、見つからない場合はスクリプトがあるディレクトリからの相対パスとして試行されます。 


## subnetgroups.csv  

| 列名        | 説明                                                                                                                                       | 必須/任意 | 補足                                                                                                                                                                                             |
| :---------- | :----------------------------------------------------------------------------------------------------------------------------------------- | :-------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `REGION`    | DBサブネットグループを作成するAWSリージョンを指定します。                                                                                      | 必須      | スクリプトはサブネットの検索およびサブネットグループの作成コマンドでこのリージョンを使用します。                                                                                                       |
| `NAME`      | 作成するDBサブネットグループの名前です。                                                                                                   | 必須      | スクリプトは `create-db-subnet-group` コマンドの `--db-subnet-group-name` として使用します。                                                                                                  |
| `SUBNETS`   | DBサブネットグループに含める1つ以上のサブネットを指定します。複数のサブネットを指定する場合は、セミコロン `;` で区切ってください。各サブネットはサブネットIDまたはサブネットのNameタグの値で指定できます。 | 必須      | スクリプトはセミコロンで分割し、各項目をサブネットID (`subnet-...`) またはサブネットのNameタグとしてリージョン内で検索します。見つかったサブネットIDを収集し、`create-db-subnet-group` コマンドの `--subnet-ids` として使用します。リスト内に有効なサブネットが一つも見つからない場合は、その行の処理はスキップされます。 |
| `DESCRIPTION` | DBサブネットグループの説明です。                                                                                                       | 必須      | スクリプトは `create-db-subnet-group` コマンドの `--db-subnet-group-description` として使用します。                                                                                              |

<br>

**補足事項:**

* スクリプトは、指定された名前のDBサブネットグループが既に存在するかどうかの明示的なチェックは行いません。`create-db-subnet-group` コマンドを実行し、成功/失敗のメッセージを表示します。すでに存在する場合は作成に失敗しますが、スクリプトはエラーとして処理します。
* `SUBNETS` 列で指定されたサブネットがすべて指定リージョンで見つからない場合、その行のDBサブnetグループの作成はスキップされます  


## optiongroups.csv  

| 列名                | 説明                                                                                                | 必須 | 補足                                                                 |
| :------------------ | :-------------------------------------------------------------------------------------------------- | :--- | :------------------------------------------------------------------- |
| `REGION`            | 対象となるAWSリージョン名 (例: `ap-northeast-1`)                                                    | 必須 | AWS CLIがアクセス権を持つリージョンである必要があります。            |
| `OPTION_GROUP_NAME` | 作成または設定対象となるRDSオプショングループの名前                                                   | 必須 | RDSの命名規則に従う必要があります。                                  |
| `ENGINE_NAME`       | RDSデータベースエンジンの種類 (例: `mysql`, `oracle-ee`, `sqlserver-se`)                           | 必須 | サポートされているエンジンの名前を指定してください。                 |
| `ENGINE_VERSION`    | データベースエンジンのメジャーバージョン。`create-option-group` コマンドで使用される形式である必要があります。 (例: `8.0`, `19`, `15.00`) | 必須 | 指定したエンジン名と一致するメジャーバージョンである必要があります。 |
| `DESCRIPTION`       | 作成するオプショングループの説明文                                                                  | 必須 |                                                                      |
| `OPTIONS_JSON`      | オプショングループに追加するオプション設定を記述したJSONファイルへのパス。スクリプト内では`OPTIONS_JSON_PATH`変数として扱われます。 | 必須 (オプション追加処理を行う場合) | JSONファイルが見つからない場合、その行のオプション追加処理はスキップされます。 |



## aurora_config.csv 

| 列名                       | 説明                                                                                                                                                                                             | 必須/任意                                                                                                | 補足                                                                                                                                                                                                                                                              |
| :--------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `REGION`                     | AWS リージョン                                                                                                                                                                                   | (必須)                                                                                                   | 例: `ap-northeast-1`, `us-east-1`                                                                                                                                                                                                                               |
| `DB_IDENTIFIER`              | 作成または管理対象の Aurora クラスター識別子                                                                                                                                                     | (必須)                                                                                                   | 英小文字、数字、ハイフンで始まり、英小文字、数字、ハイフン、ピリオドを含む、長さ 1-63 文字。末尾はハイフン以外。重複不可。                                                                                                                                                                 |
| `ENGINE`                     | 使用するデータベースエンジン                                                                                                                                                                     | (必須)                                                                                                   | `aurora-mysql` または `aurora-postgresql`                                                                                                                                                                                                                         |
| `ENGINE_VERSION`             | データベースエンジンバージョン                                                                                                                                                                     | (新規作成時必須)<br>(復元時任意)                                                                           | 新規作成時には必須です。復元時には、指定すると復元と同時にメジャーバージョンアップを行うことができます（`restore-db-cluster-from-snapshot` では `--allow-major-version-upgrade` は使えません）。 例: `8.0.mysql_aurora.3.04.0`, `15.4` など                               |
| `DB_INSTANCE_CLASS`          | DB インスタンスクラス                                                                                                                                                                            | (インスタンス管理時必須)                                                                                   | `AURORA_INSTANCE_COUNT` が1以上の場合に、インスタンス作成・管理に必要です。 例: `db.t3.medium`, `db.r6g.large` など。利用可能なインスタンスタイプはエンジンやバージョン、リージョンによります。                                                                                           |
| `CLUSTER_PARAMETER_GROUP`    | 適用する DB クラスターパラメータグループ名                                                                                                                                                       | (任意)                                                                                                   | 既存の DB クラスターパラメータグループ名                                                                                                                                                                                                                          |
| `INSTANCE_PARAMETER_GROUP`   | 適用する DB インスタンスパラメータグループ名                                                                                                                                                   | (任意)                                                                                                   | 既存のDBインスタンスパラメータグループ名                                                                                                                                                                                                            |
| `SECURITY_GROUPS`            | 適用する VPC セキュリティグループ名または ID                                                                                                                                                   | (任意)                                                                                                   | 既存のセキュリティグループ名または ID (`sg-xxxxxxxxxxxxxxxxx`)。複数指定する場合はセミコロン (`;`) で区切ります。例: `test-rds-sg;sg-040cbdf6d8b8c55d0`                                                                                                          |
| `DB_SUBNET_GROUP`            | 関連付ける DB サブネットグループ名                                                                                                                                                               | (新規作成・復元時必須)                                                                                     | 既存の DB サブネットグループ名                                                                                                                                                                                                                                    |
| `MASTER_USERNAME`            | マスターユーザー名                                                                                                                                                                             | (新規作成時:<br>`SECRET_MANAGER_ARN` 未指定の場合必須)                                                    | 新規作成時で `SECRET_MANAGER_ARN` を指定しない場合に必須です。 半角英数字など (Aurora MySQL: 1-16文字, Aurora PostgreSQL: 1-63文字)。Secrets Manager を使用する場合は不要。                                                                                                 |
| `MASTER_PASSWORD`            | マスターパスワード                                                                                                                                                                             | (新規作成時:<br>`SECRET_MANAGER_ARN` 未指定の場合必須)                                                    | 新規作成時で `SECRET_MANAGER_ARN` を指定しない場合に必須です。パスワードポリシーに準拠する必要があります。Secrets Manager を使用する場合は不要。                                                                                                                               |
| `DB_NAME`                    | 初期データベース名                                                                                                                                                                             | (任意)                                                                                                   | 指定しない場合は自動生成されるか、作成されません。 例: `devdb`, `stagedb`                                                                                                                                                                                               |
| `BACKUP_RETENTION`           | 自動バックアップの保持期間 (日数)                                                                                                                                                                | (任意)                                                                                                   | `1` から `35` までの整数 (エンジンやエディションによる)。省略時はデフォルト値が適用されます。                                                                                                                                                                              |
| `PREFERRED_BACKUP_WINDOW`    | 自動バックアップが実行される時間帯 (UTC)                                                                                                                                                         | (任意)                                                                                                   | `hh24:mi-hh24:mi` 形式。例: `04:00-05:00`                                                                                                                                                                                                                          |
| `PREFERRED_MAINTENANCE_WINDOW`| システムメンテナンスが許可される時間帯 (UTC)                                                                                                                                                     | (任意)                                                                                                   | `day:hh24:mi-day:hh24:mi` 形式。例: `fri:22:00-fri:23:00`, `sat:02:00-sat:03:00`                                                                                                                                                                                     |
| `IAM_AUTH`                   | IAM データベース認証の有効化                                                                                                                                                                     | (任意)                                                                                                   | `TRUE`, `FALSE`                                                                                                                                                                                                                                                 |
| `CLOUDWATCH_LOGS_EXPORTS`    | CloudWatch Logs にエクスポートするログタイプ。複数指定する場合はセミコロン (`;`) で区切ります。                                                                                                   | (任意)                                                                                                   | エンジンによって異なります (`audit`, `error`, `general`, `slowquery`, `postgresql` など)。例: `audit;error`, `postgresql`                                                                                                                                         |
| `DELETION_PROTECTION`        | クラスターの削除保護の有効化                                                                                                                                                                     | (任意)                                                                                                   | `TRUE`, `FALSE`                                                                                                                                                                                                                                                 |
| `PUBLICLY_ACCESSIBLE`        | クラスターエンドポイントがパブリックにアクセス可能か                                                                                                                                               | (任意)                                                                                                   |  通常はセキュリティのために `FALSE` にすべきです。                                                                                                                                                                     |
| `ENABLE_PERFORMANCE_INSIGHTS`| Performance Insights の有効化                                                                                                                                                                    | (任意)                                                                                                   | `TRUE`, `FALSE`                                                                                                                                                                                                                                                 |
| `PERFORMANCE_INSIGHTS_RETENTION`| Performance Insights のデータ保持期間 (日数)                                                                                                                                                     | (任意)                                                                                                   | `ENABLE_PERFORMANCE_INSIGHTS` が `TRUE` の場合に有効です。 `7` または拡張保持期間のいずれか (`31`, `62`, ... , `731` など)。                                                                                                                                             |
| `AURORA_INSTANCE_COUNT`      | 作成・管理する DB インスタンスの**総数** (プライマリインスタンス含む)                                                                                                                            | (任意)                                                                                                   | `1` 以上の整数。1 はプライマリのみ、2以上は指定数のリードレプリカも作成/維持します。0以下の値はインスタンス管理処理がスキップされます。                                                                                                                                          |
| `TAGS`                       | クラスターに適用する AWS タグ。複数指定する場合はセミコロン (`;`) で区切ります。                                                                                                                 | (任意)                                                                                                   | `Key=Value` 形式。例: `Env=Development;CostCenter=IT;ManagedBy=Script`                                                                                                                                                                                          |
| `SNAPSHOT_IDENTIFIER`        | 復元元の DB スナップショットの識別子                                                                                                                                                             | (復元時:<br>`SOURCE_DB_IDENTIFIER` 未指定の場合必須)                                                      | 指定する場合、`SOURCE_DB_IDENTIFIER` は指定しません。 既存の DB スナップショット ID。 例: `test-my-sql-snapshot`, `snap-test-postgre-cluster`                                                                                                                            |
| `SOURCE_DB_IDENTIFIER`       | ポイントインタイムリカバリ (PITR) を行うソース DB クラスターの識別子                                                                                                                             | (復元時:<br>`SNAPSHOT_IDENTIFIER` 未指定の場合必須)                                                      | 指定する場合、`SNAPSHOT_IDENTIFIER` は指定しません。 既存の DB クラスター ID。 例: `clone-test-aurora-cluster`                                                                                                                                                            |
| `AURORA_STORAGE_TYPE`        | Aurora ストレージタイプ                                                                                                                                                                          | (新規作成・更新時任意)                                                                                     | `aurora`, `aurora-iopt1`                                                                                                                                                                                                                                        |
| `SECRET_MANAGER_ARN`         | マスター認証情報に使用する Secrets Manager シークレットの ARN                                                                                                                                      | (新規作成時:<br>`MASTER_USERNAME`/`MASTER_PASSWORD` 未指定の場合優先)                                    | 新規作成時で、`MASTER_USERNAME`/`MASTER_PASSWORD` より優先されます。 ARN 形式 (`arn:aws:secretsmanager:リージョン:アカウントID:secret:シークレット名-xxxxxxxx`)。                                                                                                                | 
